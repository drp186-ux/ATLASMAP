<!doctype html>
<html lang="ru"><head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AtlasBus РФ — карта маршрутов (FULL)</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
html,body,#map{height:100%;margin:0;}
.panel{position:absolute;top:10px;left:10px;z-index:1000;background:rgba(255,255,255,0.95);
padding:10px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.15);max-width:720px;
font-family:system-ui;font-size:14px;}
.row{display:flex;gap:8px;margin:6px 0;align-items:center;}
select,button{padding:6px 8px;border-radius:10px;border:1px solid #ddd;background:white;}
select{width:100%;}
.legend{margin-top:8px;font-size:12px;max-height:180px;overflow:auto;}
.legend div{display:flex;align-items:center;margin-bottom:4px;}
.legend span{display:inline-block;width:14px;height:14px;margin-right:6px;border-radius:3px;}
</style></head>
<body>
<div id="map"></div>
<div class="panel">
<div class="row">
<button id="showAllBtn">Показать все маршруты</button>
<button id="showRouteBtn">Показать маршрут</button>
<button id="clearBtn">Очистить</button>
</div>
<div class="row">
<label style="min-width:85px;">Перевозчик</label>
<select id="carrierSel"></select>
</div>
<div class="row">
<label style="min-width:85px;">Маршрут</label>
<select id="routeSel"></select>
</div>
<div class="legend" id="legend"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
var ROUTES = [{"route_id": "RTE_0001", "carrier": "ИП Гальчук", "color": "#e377c2", "points": ["Котово", "Петров Вал", "Волгоград"], "route_name": "Котово → Петров Вал → Волгоград"}, {"route_id": "RTE_0002", "carrier": "ИП Румянцева О.В.", "color": "#843c39", "points": ["Волгоград", "Суровикино", "Морозовск", "Шахты", "Ростов-на-Дону"], "route_name": "Волгоград → Суровикино → Морозовск → Шахты → Ростов-на-Дону"}, {"route_id": "RTE_0003", "carrier": "ИП ХАРИНИН Ю А", "color": "#2ca02c", "points": ["Котово", "Камышин"], "route_name": "Котово → Камышин"}, {"route_id": "RTE_0004", "carrier": "ИП Борисов А М", "color": "#8c564b", "points": ["Вологда", "Липин Бор", "Вытегра"], "route_name": "Вологда → Липин Бор → Вытегра"}, {"route_id": "RTE_0005", "carrier": "ИП Алексеев Д. С.", "color": "#2ca02c", "points": ["Вологда", "Верховажье", "Вельск"], "route_name": "Вологда → Верховажье → Вельск"}, {"route_id": "RTE_0006", "carrier": "ИП Алексеев Д. С.", "color": "#2ca02c", "points": ["Вологда", "Анапа", "Кабардинка", "Геленджик"], "route_name": "Вологда → Анапа → Кабардинка → Геленджик"}, {"route_id": "RTE_0007", "carrier": "ООО АТЛАС ЛОГИСТИКА", "color": "#8c564b", "points": ["Саратов", "Балаково", "Сызрань", "Ульяновск", "Казань"], "route_name": "Саратов → Балаково → Сызрань → Ульяновск → Казань"}, {"route_id": "RTE_0008", "carrier": "ИП Александрина", "color": "#ff7f0e", "points": ["Калач-на-Дону", "Волгоград"], "route_name": "Калач-на-Дону → Волгоград"}, {"route_id": "RTE_0009", "carrier": "ИП Губин А С", "color": "#7f7f7f", "points": ["Урюпинск", "Новоаннинский", "Михайловка", "Фролово", "Иловля", "Волгоград"], "route_name": "Урюпинск → Новоаннинский → Михайловка → Фролово → Иловля → Волгоград"}, {"route_id": "RTE_0010", "carrier": "ИП Рыкованов", "color": "#7b4173", "points": ["Череповец", "Липин Бор", "Вытегра"], "route_name": "Череповец → Липин Бор → Вытегра"}, {"route_id": "RTE_0011", "carrier": "ИП Рыкованов", "color": "#7b4173", "points": ["Архангельск", "Верхняя Тойма", "Котлас"], "route_name": "Архангельск → Верхняя Тойма → Котлас"}, {"route_id": "RTE_0012", "carrier": "ИП Рыкованов", "color": "#7b4173", "points": ["Вологда", "Вельск", "Кулой", "Октябрьский"], "route_name": "Вологда → Вельск → Кулой → Октябрьский"}, {"route_id": "RTE_0013", "carrier": "ИП Рыкованов", "color": "#7b4173", "points": ["Вологда", "Ярославль", "Кострома"], "route_name": "Вологда → Ярославль → Кострома"}, {"route_id": "RTE_0014", "carrier": "ИП Мишин", "color": "#637939", "points": ["Иловля", "Волгоград"], "route_name": "Иловля → Волгоград"}, {"route_id": "RTE_0015", "carrier": "ИП Гула Роман Викторович", "color": "#bcbd22", "points": ["Саратов", "Пенза", "Саранск", "Арзамас", "Нижний Новгород"], "route_name": "Саратов → Пенза → Саранск → Арзамас → Нижний Новгород"}, {"route_id": "RTE_0016", "carrier": "СКС", "color": "#637939", "points": ["Санкт-Петербург", "Псков", "Полоцк, Беларусь", "Минск, Беларусь"], "route_name": "Санкт-Петербург → Псков → Полоцк, Беларусь → Минск, Беларусь"}, {"route_id": "RTE_0017", "carrier": "СКС", "color": "#637939", "points": ["Санкт-Петербург", "Великий Новгород"], "route_name": "Санкт-Петербург → Великий Новгород"}, {"route_id": "RTE_0018", "carrier": "Атлас Северо-Запад", "color": "#1f77b4", "points": ["Санкт-Петербург", "Череповец", "Вологда"], "route_name": "Санкт-Петербург → Череповец → Вологда"}, {"route_id": "RTE_0019", "carrier": "ИП Бабушкин (Гарант авто)", "color": "#9467bd", "points": ["Череповец", "Вологда", "Коряжма"], "route_name": "Череповец → Вологда → Коряжма"}, {"route_id": "RTE_0020", "carrier": "ИП Бабушкин (Гарант авто)", "color": "#9467bd", "points": ["Красавино", "Вологда", "Череповец"], "route_name": "Красавино → Вологда → Череповец"}, {"route_id": "RTE_0021", "carrier": "ИП Бабушкин (Гарант авто)", "color": "#9467bd", "points": ["Вологда", "Коряжма"], "route_name": "Вологда → Коряжма"}, {"route_id": "RTE_0022", "carrier": "ИП Недобельский", "color": "#8c6d31", "points": ["Вологда", "Никольск"], "route_name": "Вологда → Никольск"}, {"route_id": "RTE_0023", "carrier": "ИП Недобельский", "color": "#8c6d31", "points": ["Вологда", "Кичменский Городок"], "route_name": "Вологда → Кичменский Городок"}, {"route_id": "RTE_0024", "carrier": "ООО Автолидер", "color": "#7f7f7f", "points": ["Череповец", "Вологда", "Ярославль", "Москва"], "route_name": "Череповец → Вологда → Ярославль → Москва"}, {"route_id": "RTE_0025", "carrier": "ИП Рыльцев", "color": "#1f77b4", "points": ["Волгоград", "Камышин"], "route_name": "Волгоград → Камышин"}, {"route_id": "RTE_0026", "carrier": "ООО АТЛАС ЛОГИСТИКА", "color": "#8c564b", "points": ["Волгоград", "Камышин", "Саратов"], "route_name": "Волгоград → Камышин → Саратов"}, {"route_id": "RTE_0027", "carrier": "ИП Комалеева", "color": "#17becf", "points": ["Салават", "Казань"], "route_name": "Салават → Казань"}, {"route_id": "RTE_0028", "carrier": "ИП Комалеева", "color": "#17becf", "points": ["Оренбург", "Казань"], "route_name": "Оренбург → Казань"}, {"route_id": "RTE_0029", "carrier": "ИП Комалеева", "color": "#17becf", "points": ["Туймазы", "Набережные Челны"], "route_name": "Туймазы → Набережные Челны"}, {"route_id": "RTE_0030", "carrier": "ИП Комалеева", "color": "#17becf", "points": ["Уфа", "Казань"], "route_name": "Уфа → Казань"}, {"route_id": "RTE_0031", "carrier": "ООО Транспорт", "color": "#393b79", "points": ["Уруссу", "Набережные Челны"], "route_name": "Уруссу → Набережные Челны"}, {"route_id": "RTE_0032", "carrier": "ИП Амельченко", "color": "#d62728", "points": ["Пермь", "Казань"], "route_name": "Пермь → Казань"}, {"route_id": "RTE_0033", "carrier": "ИП Амельченко", "color": "#d62728", "points": ["Пермь", "Москва"], "route_name": "Пермь → Москва"}, {"route_id": "RTE_0034", "carrier": "ООО Победа", "color": "#bcbd22", "points": ["Уфа", "Москва"], "route_name": "Уфа → Москва"}, {"route_id": "RTE_0035", "carrier": "ООО АТП 1", "color": "#e377c2", "points": ["Уфа", "Нижний Новгород"], "route_name": "Уфа → Нижний Новгород"}, {"route_id": "RTE_0036", "carrier": "ООО РТК 2000", "color": "#17becf", "points": ["Оренбург", "Орск"], "route_name": "Оренбург → Орск"}, {"route_id": "RTE_0037", "carrier": "ИП Кужман", "color": "#393b79", "points": ["Оренбург", "Илек"], "route_name": "Оренбург → Илек"}, {"route_id": "RTE_0038", "carrier": "ИП Кужман", "color": "#393b79", "points": ["Оренбург", "Мухраново"], "route_name": "Оренбург → Мухраново"}, {"route_id": "RTE_0039", "carrier": "ООО \"ТурТранс\"", "color": "#9467bd", "points": ["Челябинск", "Кыштым"], "route_name": "Челябинск → Кыштым"}, {"route_id": "RTE_0040", "carrier": "ООО \"ТурТранс\"", "color": "#9467bd", "points": ["Челябинск", "Миасс"], "route_name": "Челябинск → Миасс"}, {"route_id": "RTE_0041", "carrier": "ООО \"ТурТранс\"", "color": "#9467bd", "points": ["Челябинск", "Екатеринбург"], "route_name": "Челябинск → Екатеринбург"}, {"route_id": "RTE_0042", "carrier": "ООО \"Бал плюс\"", "color": "#d62728", "points": ["Уфа", "Казань"], "route_name": "Уфа → Казань"}, {"route_id": "RTE_0043", "carrier": "ИП Семенов", "color": "#ff7f0e", "points": ["Оренбург", "Тюльган"], "route_name": "Оренбург → Тюльган"}];

var map=L.map('map');
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:18}).addTo(map);
map.setView([55.75,37.62],4);

var layers=[];
function clearAll(){for(var i=0;i<layers.length;i++) map.removeLayer(layers[i]); layers=[];}
document.getElementById('clearBtn').onclick=clearAll;

var cache={};
function geocode(name,cb){
 if(cache[name]) return cb(cache[name]);
 fetch('https://nominatim.openstreetmap.org/search?format=json&limit=1&q='+encodeURIComponent(name))
 .then(r=>r.json()).then(d=>{
   if(d.length){
     cache[name]=[parseFloat(d[0].lat),parseFloat(d[0].lon)];
     cb(cache[name]);
   } else cb(null);
 });
}

function drawRoute(r,done){
 var coords=[],i=0;
 function step(){
  if(i>=r.points.length){
    if(coords.length>=2){
      var line=L.polyline(coords,{weight:4,opacity:0.9,color:r.color}).addTo(map);
      layers.push(line);
    }
    return done(coords);
  }
  geocode(r.points[i],function(c){if(c)coords.push(c);i++;setTimeout(step,120);});
 }
 step();
}

var carrierSel=document.getElementById('carrierSel');
var routeSel=document.getElementById('routeSel');

function populate(){
 var carriers={};
 ROUTES.forEach(function(r){carriers[r.carrier]=r.color;});
 carrierSel.innerHTML='<option value="__ALL__">— все —</option>';
 for(var c in carriers) carrierSel.innerHTML+='<option>'+c+'</option>';
 refresh();

 var legend=document.getElementById('legend');
 for(var c in carriers) legend.innerHTML+='<div><span style="background:'+carriers[c]+'"></span>'+c+'</div>';
}

function refresh(){
 routeSel.innerHTML='';
 ROUTES.filter(r=>carrierSel.value==='__ALL__'||r.carrier===carrierSel.value)
 .forEach(r=>routeSel.innerHTML+='<option value="'+r.route_id+'">'+r.route_name+'</option>');
}

carrierSel.onchange=refresh;

document.getElementById('showRouteBtn').onclick=function(){
 clearAll();
 var r=ROUTES.find(x=>x.route_id===routeSel.value);
 if(!r) return;
 drawRoute(r,function(coords){if(coords.length>=2) map.fitBounds(L.latLngBounds(coords),{padding:[30,30]});});
};

document.getElementById('showAllBtn').onclick=function(){
 clearAll();
 var queue=ROUTES.filter(r=>carrierSel.value==='__ALL__'||r.carrier===carrierSel.value);
 var i=0,bounds=null;
 function next(){
  if(i>=queue.length){if(bounds) map.fitBounds(bounds,{padding:[30,30]});return;}
  drawRoute(queue[i],function(coords){
    if(coords.length>=2){
      var b=L.latLngBounds(coords);
      bounds=bounds?bounds.extend(b):b;
    }
    i++;setTimeout(next,80);
  });
 }
 next();
};

populate();
</script>
</body></html>
